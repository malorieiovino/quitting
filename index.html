<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sobriety Streak Tracker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            color: #333;
            background-color: #f9f9f9;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .streak-container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .streak-number {
            font-size: 80px;
            font-weight: bold;
            color: #27ae60;
            margin: 0;
            line-height: 1;
        }
        
        .streak-label {
            font-size: 20px;
            color: #7f8c8d;
            margin-top: 10px;
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            background-color: #2980b9;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3498db;
        }
        
        button.reset {
            background-color: #e74c3c;
        }
        
        button.reset:hover {
            background-color: #c0392b;
        }
        
        .milestone {
            padding: 10px 15px;
            background-color: #f1c40f;
            color: #34495e;
            border-radius: 6px;
            display: inline-block;
            margin-top: 20px;
            font-weight: bold;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            text-align: center;
        }
        
        .stat-box {
            flex: 1;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            margin: 0 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #16a085;
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        @media (max-width: 480px) {
            .streak-number {
                font-size: 60px;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .stat-box {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <h1>Sobriety Streak Tracker</h1>
    
    <div class="streak-container">
        <p class="streak-number" id="streak">0</p>
        <p class="streak-label">DAYS CLEAN</p>
        
        <div id="milestone-container"></div>
        
        <div class="button-container">
            <button id="editButton">Edit Start Date</button>
            <button id="resetButton" class="reset">Reset Streak</button>
        </div>
    </div>
    
    <div class="stats">
        <div class="stat-box">
            <p class="stat-value" id="longest-streak">0</p>
            <p class="stat-label">LONGEST STREAK</p>
        </div>
        <div class="stat-box">
            <p class="stat-value" id="total-days">0</p>
            <p class="stat-label">TOTAL DAYS CLEAN</p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const streakElement = document.getElementById('streak');
            const milestoneContainer = document.getElementById('milestone-container');
            const editButton = document.getElementById('editButton');
            const resetButton = document.getElementById('resetButton');
            const longestStreakElement = document.getElementById('longest-streak');
            const totalDaysElement = document.getElementById('total-days');
            
            // Milestone definitions
            const milestones = [
                { days: 1, message: "First day complete! 🎉" },
                { days: 3, message: "3 days! The hardest part is over." },
                { days: 7, message: "One week strong! 💪" },
                { days: 14, message: "Two weeks! Your body is thanking you." },
                { days: 21, message: "21 days! New habits are forming." },
                { days: 30, message: "30 days! A whole month clean! 🎉" },
                { days: 60, message: "60 days! You're crushing it!" },
                { days: 90, message: "90 days! Major brain healing happening!" },
                { days: 180, message: "Half a year! Incredible achievement!" },
                { days: 365, message: "ONE YEAR SOBER! 🏆" }
            ];
            
            // History of streaks
            let streakHistory = JSON.parse(localStorage.getItem('streakHistory')) || [];
            
            // Load data
            let startDate = localStorage.getItem('sobrietyStartDate');
            let streakCount = 0;
            let longestStreak = parseInt(localStorage.getItem('longestStreak')) || 0;
            let totalDays = parseInt(localStorage.getItem('totalDays')) || 0;
            
            // Calculate streak if start date exists
            if (startDate) {
                const start = new Date(startDate);
                const today = new Date();
                
                // Reset to beginning of day for accurate calculation
                start.setHours(0, 0, 0, 0);
                today.setHours(0, 0, 0, 0);
                
                // Calculate difference in days
                const diffTime = today.getTime() - start.getTime();
                streakCount = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                // Update streak display
                updateDisplay();
            }
            
            // Update all display elements
            function updateDisplay() {
                streakElement.textContent = streakCount;
                
                // Check for milestone
                const currentMilestone = milestones.filter(m => m.days <= streakCount).pop();
                const nextMilestone = milestones.find(m => m.days > streakCount);
                
                // Clear previous milestone
                milestoneContainer.innerHTML = '';
                
                // Show next milestone or current if it's the exact day
                if (nextMilestone) {
                    const daysToNext = nextMilestone.days - streakCount;
                    if (daysToNext === 0) {
                        milestoneContainer.innerHTML = `<div class="milestone">${nextMilestone.message}</div>`;
                    } else {
                        milestoneContainer.innerHTML = `<div class="milestone">${daysToNext} days until ${nextMilestone.days}-day milestone</div>`;
                    }
                } else if (currentMilestone && currentMilestone.days === streakCount) {
                    milestoneContainer.innerHTML = `<div class="milestone">${currentMilestone.message}</div>`;
                }
                
                // Update stats
                longestStreakElement.textContent = Math.max(longestStreak, streakCount);
                totalDaysElement.textContent = totalDays + streakCount;
            }
            
            // Edit start date button
            editButton.addEventListener('click', function() {
                const existingDate = startDate ? new Date(startDate).toISOString().split('T')[0] : '';
                const newDate = prompt(`Enter your sobriety start date (YYYY-MM-DD):`, existingDate);
                
                if (newDate && isValidDate(newDate)) {
                    // If there was a previous streak, save it to history
                    if (startDate && streakCount > 0) {
                        const oldStart = new Date(startDate);
                        const oldEnd = new Date();
                        oldEnd.setDate(oldEnd.getDate() - 1); // Yesterday
                        
                        streakHistory.push({
                            start: oldStart.toISOString().split('T')[0],
                            end: oldEnd.toISOString().split('T')[0],
                            days: streakCount
                        });
                        
                        // Update total days
                        totalDays += streakCount;
                        localStorage.setItem('totalDays', totalDays);
                        
                        // Update longest streak
                        if (streakCount > longestStreak) {
                            longestStreak = streakCount;
                            localStorage.setItem('longestStreak', longestStreak);
                        }
                        
                        // Save history
                        localStorage.setItem('streakHistory', JSON.stringify(streakHistory));
                    }
                    
                    // Set new start date
                    startDate = newDate;
                    localStorage.setItem('sobrietyStartDate', startDate);
                    
                    // Recalculate streak
                    const start = new Date(startDate);
                    const today = new Date();
                    start.setHours(0, 0, 0, 0);
                    today.setHours(0, 0, 0, 0);
                    
                    const diffTime = today.getTime() - start.getTime();
                    streakCount = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                    
                    // Update display
                    updateDisplay();
                } else if (newDate) {
                    alert("Please enter a valid date in YYYY-MM-DD format.");
                }
            });
            
            // Reset streak button
            resetButton.addEventListener('click', function() {
                if (confirm("Are you sure you want to reset your streak? This will save your current streak to history.")) {
                    // Save current streak to history if it exists
                    if (startDate && streakCount > 0) {
                        const oldStart = new Date(startDate);
                        const oldEnd = new Date();
                        oldEnd.setDate(oldEnd.getDate() - 1); // Yesterday
                        
                        streakHistory.push({
                            start: oldStart.toISOString().split('T')[0],
                            end: oldEnd.toISOString().split('T')[0],
                            days: streakCount
                        });
                        
                        // Update total days
                        totalDays += streakCount;
                        localStorage.setItem('totalDays', totalDays);
                        
                        // Update longest streak
                        if (streakCount > longestStreak) {
                            longestStreak = streakCount;
                            localStorage.setItem('longestStreak', longestStreak);
                        }
                        
                        // Save history
                        localStorage.setItem('streakHistory', JSON.stringify(streakHistory));
                    }
                    
                    // Reset start date to today
                    const today = new Date();
                    startDate = today.toISOString().split('T')[0];
                    localStorage.setItem('sobrietyStartDate', startDate);
                    
                    // Reset streak counter
                    streakCount = 0;
                    
                    // Update display
                    updateDisplay();
                }
            });
            
            // Helper function to validate date format
            function isValidDate(dateString) {
                const regex = /^\d{4}-\d{2}-\d{2}$/;
                if (!regex.test(dateString)) return false;
                
                const date = new Date(dateString);
                return date instanceof Date && !isNaN(date);
            }
        });
    </script>
</body>
</html>
